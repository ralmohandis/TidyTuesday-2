---
title: "Coffee"
author: "Joel Soroos"
date: "7/7/2020"
output: html_document
---

### 1. Source data
```{r source, warning = TRUE, results = TRUE, message = FALSE}

   library(tidyverse)
   library(janitor)
   library(knitr)
   
   opts_chunk$set(warning = FALSE, message = FALSE, results = TRUE)
   
   coffee_all <- tidytuesdayR::tt_load('2020-07-07')

   coffee_raw <- coffee_all$coffee_ratings
```


### 2.  Explore  data
```{r explore}

   library(skimr)

   coffee_raw %>%
      tabyl (country_of_origin) %>%
      arrange (-percent) %>%
      head(20)

   skim (coffee_raw)

```

### 3.  Transform stage data
```{r transform, warning = TRUE, results = FALSE, message = FALSE}
   
   country_significant <- coffee_raw %>%
      count (country_of_origin) %>%
      filter (n>8) %>%
      arrange (n) %>%
      pull (country_of_origin)   

   coffee <- coffee_raw %>%
      filter (
         total_cup_points>65,
         country_of_origin %in% country_significant
         ) %>%
      select (country_of_origin, total_cup_points) %>%
      drop_na () %>%
      mutate (country_of_origin = recode (country_of_origin,
              "United States (Hawaii)" = "USA",
              "United States (Puerto Rico)" = "USA",
              "United States" = "USA",
              "Tanzania, United Republic Of" = "Tanzania"
              )) 
   
   coffee_summ <- coffee %>%
      group_by (country_of_origin) %>% 
      summarize (
         rating_min = min (total_cup_points),
         rating_med = median (total_cup_points)
         )
```

 
### 4.  Visualize data
```{r transform, warning = TRUE, results = FALSE, message = FALSE}

   library (gghighlight)
   library (ggridges)
   library (ggbeeswarm)

   ggplot (coffee, aes (x = total_cup_points, y = reorder(country_of_origin, total_cup_points))) +
   #geom_beeswarm (groupOnX = F) +
   geom_point(shape = "|", color = "white") +
   #geom_text (
      #data = coffee_summ,
      #aes(x = rating_min -2, y = country_of_origin, label = country_of_origin),
      #inherit.aes = F,
      #size = 3, color = "white"
      #) +
   theme (
      plot.background = element_rect(fill= "#6F4E37"),
      plot.title = element_text(hjust = 0.5, vjust = 0, size = 14, face = "bold", margin = margin (0,0,7,0)),
      plot.subtitle = element_text (hjust = 0.5, vjust = 0, size = 10, margin = margin (0,0,25,0)),
      plot.caption = element_text (hjust = 1, size = 8, margin = margin (10,0,0,0)),
      plot.caption.position = "plot",
      panel.background = element_rect(fill= "#6F4E37"),
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      axis.title = element_text (size = 8, hjust = 0),
      axis.text = element_text (color = "white"),
      axis.ticks.y = element_blank(),
      legend.position = "none",
      text = element_text(color = "white")
      ) +
   labs(
      title = "Coffee Ratings",
      subtitle = "Placeholder",
      x = "Median Total Cup Points",
      y = "",
      caption = "Each row represents distribution of total points earned by country.\nVisualization: Joel Soroos @soroosj  |  Data: Coffee Quality Database via Kaggle via R4DS Tidy Tuesday"
   ) +
   ggsave ("coffee.png")
```   
