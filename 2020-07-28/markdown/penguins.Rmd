---
title: "Penguins"
author: "Joel Soroos"
date: "9/30/2020"
output: html_document
---


```{r source, warning = FALSE, message = FALSE}

   library(tidyverse)
   library(palmerpenguins)
   library(janitor)

   penguins_raw <- read_csv(path_to_file("penguins_raw.csv")) %>%
      clean_names()
```


```{r explore}

   library(skimr)

   #skim (penguins_raw)
```


```{r transform}

   library (glue)
   
   penguins <- penguins_raw %>%
      rename (
         bill_length = culmen_length_mm,
         bill_depth = culmen_depth_mm,
         flipper_length = flipper_length_mm,
         body_mass = body_mass_g
         ) %>%
      mutate (
         study_sample = glue ("{study_name}-{sample_number}"),
         species = word (species, 1),
         bill_length = scale(bill_length),
         bill_depth = scale(bill_depth),
         flipper_length = scale(flipper_length),
         body_mass = scale(body_mass)
         ) %>%
      select (bill_length, bill_depth, flipper_length, body_mass) %>%
      drop_na
```

```{r}

   library(broom)
   library(here)
   
   set.seed(45)
   
   #https://www.tidymodels.org/learn/statistics/k-means/
   
   penguins_clust_all <- 
      tibble (k = 1:9) %>%
      mutate (
         cluster = map(k, ~kmeans(penguins, .x)),
         tidied = map(cluster, tidy),
         glanced = map(cluster, glance),
         augmented = map(cluster, augment, penguins)
      )
   
   penguins_clusterings <- penguins_clust_all %>%
      unnest (glanced) %>%
      select (-cluster, -tidied, -augmented) %>%
      clean_names %>%
      write_csv (here("2020-07-28","output", "model.csv"))
   
   penguins_clusters <- penguins_clust_all %>%
      unnest (tidied, names_repair = "unique") %>%
      rename (cluster = cluster...9) %>%
      select (-cluster...2, -glanced, -augmented) %>%
      relocate (cluster, .after = k) %>%
      mutate (cluster = as.integer(cluster)) %>%
      write_csv (here("2020-07-28","output", "clusters.csv"))
   
   penguins_assignments <- penguins_clust_all %>%
      unnest (augmented) %>%
      select (-cluster, -glanced, -tidied) %>%
      rename (cluster = .cluster) %>%
      relocate (cluster, .after = k)  %>%
      mutate (cluster = as.integer(cluster)) %>%
      write_csv (here("2020-07-28","output", "assignments.csv"))
```

