---
   title: "Nuclear Explosions"
   author: "Joel Soroos"
   date: "September 1, 2019"
   output: pdf_document
---

### 1a. Source nuclear explosion data
```{r source, warning = TRUE, results = FALSE, message = FALSE}

   library (tidyverse)
   library (janitor) 

   explosions_raw <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-08-20/nuclear_explosions.csv") %>%
      clean_names () %>%
      drop_na (country)
```
   

### 2.  Transform UFO data
```{r transform, message = F}

  library (glue)

   explosions <- explosions_raw %>%
      mutate (
         lustrum = floor( year / 5) * 5,
         lustrum_long = glue ("{lustrum} - {lustrum + 5}"),
         country = ifelse(country == "PAKIST", "Pakistan", country),
         country = ifelse(country %in% c("FRANCE", "INDIA", "CHINA"), str_to_title (country), country)
         ) %>%
      group_by (lustrum_long) %>%
         count (country) %>%
         arrange (lustrum_long, n) %>%
         mutate(rank = row_number(-n) * 1) %>%
         ungroup () %>%
      arrange (lustrum_long, rank)
```

### 3. Visualize data
```{r plot}

   library (gganimate)
   library (gifski)
   library (scales)

   g <-ggplot (explosions, aes (rank)) +
      geom_tile (
         aes(y = n/2, height = n),
         width = 0.5, fill = "black"
         ) +
      #bar labels
         geom_text(
            aes(y = 0, label = glue ("{country}   ")), 
            hjust = 1, color = "black", size = 5
            ) +
         geom_text(
            aes(y = n, label = glue (" {n}")), 
            hjust = "left", color = "black", size = 5
            ) +
      coord_flip (clip = "off", expand = FALSE) +
      scale_x_reverse() +
      ylim (-70, 460) +
      theme(
         plot.background = element_rect(fill = "#fdf6e3"),
         panel.background = element_rect(fill = "#fdf6e3"),     
         panel.grid = element_blank (),
         plot.title = element_text(hjust = 0.5, vjust = 0, size = 18, face = "bold"),
         plot.caption = element_text (hjust = 1, size = 12),
         axis.title = element_blank(),
         axis.text = element_blank(),
         axis.ticks = element_blank()
         ) +
      #animation
         transition_states(lustrum_long, transition_length = 8, state_length = 6) +
         ease_aes('cubic-in-out') +
      labs(
         title = "Nuclear Explosions: {closest_state} \n\n",
         y = "Number of nuclear explosions\n",
         caption = "Data: Stockholm International Peace Research Institute via R4DS Tidy Tuesday\nVisualization: Joel Soroos @soroosj"
         )

      animate(g, 60, fps = 1,  width = 800, height = 600, 
        renderer = gifski_renderer("explosions.gif"))
      
      #https://stackoverflow.com/questions/53162821/animated-sorted-bar-chart-with-bars-overtaking-each-other

```
