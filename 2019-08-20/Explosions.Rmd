---
   title: "Explosions"
   author: "Joel Soroos"
   date: "August 27, 2019"
   output: pdf_document
---

### 1a. Source nuclear explosion data
```{r source, warning = TRUE, results = FALSE, message = FALSE}

   library (tidyverse)
   library (janitor) 

   explosions_raw <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-08-20/nuclear_explosions.csv") %>%
      clean_names () %>%
      drop_na (country)
```
   

### 2.  Transform UFO data
```{r transform, message = F}

   explosions <- explosions_raw %>%
      mutate (decade = floor(year / 10) * 10) %>%
      group_by (decade) %>%
      count (country) %>%
      mutate(rank = min_rank(-n) * 1) %>%
      ungroup () %>%
      arrange (decade, rank)
```

### 3. Visualize data
```{r plot}

   library (gganimate)
   library (gifski)
   library (png)

   g <-ggplot (explosions, aes (rank)) +
      geom_tile (
         aes(y = n/2, height = n),
         width = 0.9, fill = "black"
         ) +
      #bar labels
         geom_text(
            aes(y = 0, label = paste (country, "  ")), 
            hjust = 1, color = "black"
            ) +
         geom_text(
            aes(y = n, label = paste ("   ", n)), 
            hjust = "left", color = "black"
            ) +
      coord_flip (clip = "off", expand = FALSE) +
      scale_x_reverse() +
      ylim (-30, NA) +
      theme(
         axis.title = element_blank(),
         axis.text = element_blank(),
         axis.ticks = element_blank(),
         plot.title = element_text(hjust = 0.5, vjust = 0, size = 16, face = "bold"),
         plot.caption = element_text (hjust = 0, size = 12),
         plot.background = element_rect(fill = "#fdf6e3"),
         panel.background = element_rect(fill = "#fdf6e3"),     
         panel.grid = element_blank ()
         ) +
      #animation
         transition_states(decade, transition_length = 8, state_length = 6) +
         ease_aes('cubic-in-out') +
      labs(
         title = "Decade : {closest_state}s\n\n",
         y = "Number of nuclear explosions\n",
         caption = "\nData: Wikipedia   Visualization: Joel Soroos @soroosj"
         )

      animate(g, 24, fps = 2,  width = 800, height = 600, 
        renderer = gifski_renderer("explosions.gif"))
      
      #https://stackoverflow.com/questions/53162821/animated-sorted-bar-chart-with-bars-overtaking-each-other

```
