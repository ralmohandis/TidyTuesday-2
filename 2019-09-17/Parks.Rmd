---
   title: "National Parks"
   author: "Joel Soroos"
   date: "September 29, 2019"
   output: pdf_document
---


### 1. Source data
```{r source, warning = TRUE, results = FALSE, message = FALSE}

   library (tidyverse)
   library (janitor) 

   visits_raw <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-09-17/national_parks.csv") %>%
      clean_names ()
```


### 2.  Transform visits
```{r transform, message = F, results = F}

   visits <- visits_raw %>%
      rename (park_name = unit_name) %>%
      filter (
         unit_type == "National Park",
         park_name != "Total",
         year %in% c(1966,2016)
         ) %>%
      select(year, park_name, state, visitors) %>%
      mutate (
         year = as.numeric (year),
         park_name = str_remove (park_name, " National Park")
         ) %>%
      arrange (-year, -visitors) %>%
      group_by (year) %>%
         mutate (z_visitors = round(scale (visitors),2)) %>%
         do(head(., n = 10)) %>%
      ungroup (year)

```


### 3. Visualize data
```{r plot}

library (ggrepel)

 ggplot(data = visits, aes(x = year, y = z_visitors, group = park_name)) +
    geom_line(
       aes(color = park_name),
       alpha = 1, size = 1
       )+
    geom_text_repel(
       data = visits %>% filter(year == 1966), 
       aes(label = park_name) ,
       hjust = "left", fontface = "bold", size = 3, nudge_x = -.45, direction = "y"
       ) +
    geom_text_repel(
       data = visits %>% filter(year == 2016), 
       aes(label = park_name) , 
       hjust = "right", fontface = "bold", size = 3, nudge_x = .5, direction = "y"
       ) +
    geom_label(
       aes(label = z_visitors), 
       size = 2.5, 
       label.padding = unit(0.05, "lines"), 
       label.size = 0.0
       ) +
    scale_x_discrete(position = "top") +
    theme_bw() +
    theme(
       legend.position = "none",
       panel.border     = element_blank(),
       axis.title.y     = element_blank(),
       axis.text.y      = element_blank(),
       panel.grid.major.y = element_blank(),
       panel.grid.minor.y = element_blank(),
       axis.title.x     = element_blank(),
       panel.grid.major.x = element_blank(),
       axis.text.x.top      = element_text(size=12),
       axis.ticks       = element_blank(),
       plot.title       = element_text(size=14, face = "bold", hjust = 0.5),
       plot.subtitle    = element_text(hjust = 0.5)
         ) +
     labs(
       title = "Estimates of Percent Survival Rates",
       subtitle = "Based on: Edward Tufte, Beautiful Evidence, 174, 176.",
       caption = "Visualization: Joel Soroos @soroosj  |  Data: Wikipedia via R4DS Tidy Tuesday"
     ) +
      ggsave("parks.png", width = 22, height = 13, units = "cm")
```