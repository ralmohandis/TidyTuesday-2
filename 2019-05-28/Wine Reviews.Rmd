---
title: "Wine Reviews"
author: "Joel Soroos"
date: "May 31, 2019"
output: pdf_document:
---

### 1. Get data
```{r source, warning = TRUE, results = FALSE, message = FALSE}

   library (janitor)  
   library (tidyverse)

   wine_raw <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-05-28/winemag-data-130k-v2.csv") %>%
      clean_names ()

```


### 2. Transform data
```{r transform, message = F}

   wine <- wine_raw %>%
      drop_na (variety, price) %>%
      mutate (variety = as.factor(variety)) %>%
      select (variety, price) %>%
      group_by (variety) %>%
         mutate(quartile = ntile(price, 4)) %>%
      ungroup ()
      
   variety_large <- wine %>%
      group_by (variety) %>%
      summarize (n = n()) %>%
      arrange (-n) %>%
      top_n (10) %>%
      select (-n)
   
   variety_large <-variety_large$variety

```

### 4. Visualize
```{r plot}

library (scales)
library (ggthemes)
library (ggdark)

   ggplot (
         data = subset (wine, variety %in% variety_large),
         aes (x = reorder(variety, price, median), y = price, fill = quartile)
           ) +
      geom_violin(draw_quantiles = c(.25,.50,.75)) +
      scale_x_discrete(position = "top") +
      scale_y_continuous (trans = log10_trans()) +
      dark_mode(theme_minimal()) +
      theme (
          plot.title = element_text(hjust = 0, size = 12),
          plot.caption = element_text(hjust = 0, size = 9),
          axis.ticks = element_blank()
         ) +
      coord_flip () +
      labs(
         title = "Wine prices per varietal",
         caption = "\nSources: Wine Enthusiast, Kaggle, R4DS Tidy Tuesday\nVisualization: Joel Soroos (Twitter: @soroosj)",
         x = "",
         y = "Price per 750ml bottle"
         ) +
   ggsave("wine.png")

```
