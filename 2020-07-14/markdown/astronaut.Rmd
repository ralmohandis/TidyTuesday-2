---
title: "Astronauts"
author: "Joel Soroos"
date: "8/31/2020"
output: html_document
---


### 1. Source data
```{r source, warning = FALSE, message = FALSE}

   library(tidyverse)
   library(here)

   #download astronaut mission data
   astronaut_raw <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-07-14/astronauts.csv')
   
   #download astronaut photos
   astronaut_photos <- read_csv(here("2020-07-14", "source", "astronaut photos.csv"))
   
   #download outer space image for chart background
   space_img <- "https://cdn.wallpapersafari.com/83/9/z8eIEZ.jpg"
```


### 2.  Explore data
```{r explore}

   library(skimr)
   library(here)

   skim (astronaut_raw)
```


### 3.  Transform data
```{r transform}

   library (glue)
   library (countrycode)
   
   #https://en.wikipedia.org/wiki/List_of_spaceflight-related_accidents_and_incidents
   astronaut_fatality <- astronaut_raw %>%
      filter (mission_title %in% c("Soyuz 1","Soyuz 11","STS-107", "STS-51L","STS-51-L", "STS 51-L")) %>%
      pull (name)

   astronaut <- astronaut_raw %>%
      group_by (name) %>%
      arrange (-mission_number) %>%
      filter (name %in% astronaut_fatality)%>%
      slice(1) %>%
      mutate (
         name_clean = glue ("{word(name,2)} {word (name, 1)}"),
         name_clean = str_remove(name_clean,","),
         year_of_mission = if_else(year_of_mission == 1985, 1986, year_of_mission),
         birth_death = glue ("{year_of_birth} - {year_of_mission}"),
         nationality_name = ifelse (nationality == "U.S.S.R/Russia", "Russia",nationality),
         nationality_code = countrycode(nationality_name, origin = "country.name", destination = "iso2c"),
         number_global_nation = glue ("{nationwide_number}/{number}"),
         mission_hours = round(total_hrs_sum,0),
         mission_hours_count= glue ("{total_number_of_missions}/{mission_hours}"),
         mission_title = recode (mission_title, "STS-51-L" = "STS-51L", "STS 51-L" = "STS-51L")
         ) %>%
      left_join (astronaut_photos) %>%
      ungroup (name) %>%
      select (name_clean, birth_death, nationality_code, number_global_nation, mission_title, year_of_mission, mission_hours_count, photo) %>%
      arrange (mission_title, name_clean)
      #head(2)
```


### 4.  Visualize - indvidual charts
```{r visualize_med}

   library (ggimage)

   #dev.set(dev.next())

   g <- ggplot (astronaut) +
      #add box header
         geom_rect(aes (xmin = 0, xmax = 1, ymin = 0.77, ymax = 1, fill = mission_title, color = mission_title), size = 3) +
      #add astronaut name
         geom_text(aes (x = 0.5, y = 0.97, label = name_clean), size = 3, hjust = 0.5, color = "white") +
      #add astronaut years of life
         geom_text(aes (x = 0.5, y = 0.85, label = birth_death), size = 3, hjust = 0.5, vjust = 1, color = "white") +
      #add astronaut photo
         #geom_image(aes(x=0.5, y=0.5, image = photo), size = 0.32) +
      #add country flag
         geom_flag(aes (x = 0.09, y = 0.8, image = nationality_code), size = 0.2, hjust = 0.5, vjust = 0) +
     #add astronaut sequence number
         geom_text(aes (x = 0, y = 0, label = number_global_nation), size = 3, hjust = 0, vjust = 0, color = "white") +
      #add number of missions
         geom_text (aes (x = 1, y = 0, label = mission_hours_count), size = 3, hjust = 1, vjust = 0, color = "white") +
      scale_color_viridis_d (end = .6) +
      scale_fill_viridis_d (end = .6) +
      labs(
         title = "In memory of the astronauts who died in space",
         caption = "Visualization: Joel Soroos @soroosj  |  Data: Astronaut Database"
         ) +
      theme_void() +
      theme (
         plot.title = element_text (color = "white", margin = margin(0,0,15,0), hjust = 0.5, size = 14),
         plot.title.position = "plot",
         plot.caption = element_text (color = "white", margin = margin(15,0,3,0), hjust = 1, size = 8),
         plot.caption.position = "plot",
         panel.border = element_rect (color = "white", fill = NA),
         strip.background = element_blank(),
         strip.text = element_blank(),
         legend.title = element_blank(),
         legend.text = element_text(color = "white", hjust = 0),
         legend.position = "bottom",
         legend.justification = "left",
         legend.direction = "horizontal"
         ) +
      facet_wrap (vars(year_of_mission, mission_title, name_clean)) 
   
      ggbackground (g, space_img, alpha = 0.2)
      ggsave(here("2020-07-14", "output", "astronaut.png"))
```